<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Contest Admin - $NUTS Sports Pick'em</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="src/assets/images/nuts-logo.jpg">
    
    <!-- Styles -->
    <link rel="stylesheet" href="src/css/styles.css">
    
    <style>
        body {
            background: #0a0a0a;
            color: white;
            margin: 0;
            padding: 100px 0 20px 0; /* Add top padding for navbar */
            font-family: 'Inter', sans-serif;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid #333;
            text-align: center;
        }
        
        .admin-title {
            color: #4CAF50;
            font-size: 28px;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        
        .admin-subtitle {
            color: #ccc;
            margin: 0;
            font-size: 16px;
        }
        
        .section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .section-title {
            color: #4CAF50;
            font-size: 20px;
            margin: 0 0 20px 0;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-area {
            border: 2px dashed #444;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }
        
        .upload-area.dragover {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #666;
        }
        
        .btn-warning {
            background: #ff9800;
        }
        
        .btn-danger {
            background: #f44336;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: #1a1a1a;
        }
        
        th {
            background: #2a2a2a;
            padding: 15px;
            text-align: left;
            color: #4CAF50;
            font-weight: bold;
            border-bottom: 2px solid #333;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #333;
        }
        
        tr:hover {
            background: #252525;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-draft { background: #666; }
        .status-published { background: #2196F3; }
        .status-locked { background: #ff9800; }
        .status-resolved { background: #4CAF50; }
        .status-cancelled { background: #f44336; }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
        }
        
        .btn-edit { background: #2196F3; }
        .btn-answers { background: #ff9800; }
        .btn-calculate { background: #4CAF50; }
        .btn-winners { background: #ffd700; color: #000; }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .game-card {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .game-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        
        .game-teams {
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 8px;
        }
        
        .game-time {
            color: #ccc;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .modal-content {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: white;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #ccc;
        }
        
        .success-message {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
        
        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="src/assets/images/nuts-logo.jpg" alt="$NUTS Logo" class="logo" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                <span class="brand-text">$NUTS Admin</span>
            </div>
            <div class="nav-links desktop-nav">
                <a href="index.html" class="nav-link">‚Üê Back to Site</a>
                <a href="admin-daily-unified.html" class="nav-link active">Daily Contest Admin</a>
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1 class="admin-title">üèÜ Daily Contest Administration</h1>
            <p class="admin-subtitle">Production Mode - Upload games, create contests, manage winners - all in one place</p>
            <div style="background: #4CAF50; color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; margin-top: 10px; font-size: 12px; font-weight: bold;">
                üî• PRODUCTION MODE - Live Database
            </div>
        </div>

        <!-- Games Upload Section -->
        <div class="section">
            <h2 class="section-title">üìä 1. Upload Games</h2>
            
            <!-- Upload Method Tabs -->
            <div style="margin-bottom: 20px;">
                <button id="csv-tab" class="btn" onclick="admin.switchUploadMethod('csv')" style="margin-right: 10px;">üìÅ CSV Upload</button>
                <button id="manual-tab" class="btn btn-secondary" onclick="admin.switchUploadMethod('manual')">‚úèÔ∏è Manual Entry</button>
            </div>
            
            <!-- CSV Upload Area -->
            <div id="csv-upload-area" class="upload-method">
                <div class="upload-area" id="upload-area">
                    <div style="font-size: 48px; margin-bottom: 15px;">üìÅ</div>
                    <h3>Drop CSV/TXT file here or click to browse</h3>
                    <p style="color: #888; margin: 10px 0;">
                        Format: "Team A, Team B" or "Date, Team1, Team2, Time"
                    </p>
                    <input type="file" id="file-input" accept=".csv,.txt" style="display: none;">
                    <button class="btn" onclick="document.getElementById('file-input').click()">
                        üìÅ Choose File
                    </button>
                </div>
            </div>
            
            <!-- Manual Entry Area -->
            <div id="manual-upload-area" class="upload-method" style="display: none;">
                <div style="margin-bottom: 15px;">
                    <h3 style="color: #4CAF50;">Enter Games (Simple Format)</h3>
                    <p style="color: #888; margin: 5px 0;">
                        Format: Team A, Team B (one game per line)
                    </p>
                </div>
                <textarea id="manual-games-input" placeholder="Yankees, Red Sox
Dodgers, Giants  
Mets, Phillies" 
                    style="
                        width: 100%; 
                        height: 200px; 
                        background: #2a2a2a; 
                        border: 1px solid #444; 
                        color: white; 
                        padding: 15px; 
                        border-radius: 8px;
                        font-family: monospace;
                        font-size: 14px;
                        resize: vertical;
                    "></textarea>
                <div style="margin-top: 15px;">
                    <button class="btn" id="process-manual-btn">
                        ‚úÖ Process Games
                    </button>
                    <button class="btn btn-secondary" onclick="admin.clearManualInput()" style="margin-left: 10px;">
                        üóëÔ∏è Clear
                    </button>
                </div>
            </div>
            
            <div id="upload-status" class="loading">
                <div>‚è≥ Processing CSV file...</div>
            </div>
            
            <div id="upload-success" class="success-message">
                ‚úÖ Games uploaded successfully!
            </div>
            
            <div id="upload-error" class="error-message">
                ‚ùå Error uploading games. Please check the format.
            </div>
            
            <!-- Uploaded Games Display -->
            <div id="games-section" style="display: none;">
                <h3 style="color: #4CAF50; margin: 20px 0 10px 0;">üìã Available Games</h3>
                <div id="games-container" class="games-grid">
                    <!-- Games will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Contest Management Section -->
        <div class="section">
            <h2 class="section-title">üéÆ 2. Daily Contest Management</h2>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="refreshContests()">üîÑ Refresh Contests</button>
                <button class="btn btn-secondary" onclick="createTodaysDailyContest()">‚ûï Create Today's Daily Contest</button>
            </div>
            
            <div id="contests-loading" class="loading">
                <div>‚è≥ Loading contests...</div>
            </div>
            
            <div class="table-container">
                <table id="contests-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Contest Details</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Games</th>
                            <th>Entry Fee</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="contests-tbody">
                        <!-- Contests will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="contest-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">Create New Contest</h2>
            <div id="modal-body">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="config/config-browser.js"></script>
    <script src="config/environment.js"></script>
    <script src="src/js/firebase-integration.js"></script>

    <script>
        // Unified Admin System
        class UnifiedAdmin {
            constructor() {
                this.games = [];
                this.contests = [];
                this.init();
            }

            init() {
                console.log('üèÜ Initializing Production Admin System...');
                this.setupEventListeners();
                this.initializeProductionMode();
            }

            async initializeProductionMode() {
                try {
                    console.log('‚è≥ Waiting for Firebase configuration...');
                    
                    // Wait for config and Firebase integration to load
                    let configLoaded = false;
                    let attempts = 0;
                    
                    while (!configLoaded && attempts < 50) {
                        if (window.config?.firebase && typeof firebase !== 'undefined') {
                            configLoaded = true;
                            break;
                        }
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }
                    
                    if (!configLoaded) {
                        throw new Error('Firebase configuration or SDK not loaded');
                    }
                    
                    await this.waitForFirebase();
                    console.log('üî• Production mode activated - Firebase connected');
                    this.loadExistingGames();
                    this.loadContests();
                } catch (error) {
                    console.error('‚ùå Production initialization failed:', error);
                    this.showError('Production Mode Error: ' + error.message);
                }
            }

            setupEventListeners() {
                // File upload
                const fileInput = document.getElementById('file-input');
                const uploadArea = document.getElementById('upload-area');

                fileInput.addEventListener('change', (e) => this.handleFileSelect(e));

                // Manual entry
                const processManualBtn = document.getElementById('process-manual-btn');
                if (processManualBtn) {
                    processManualBtn.addEventListener('click', () => this.processManualGames());
                }

                // Drag and drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.processCSVFile(files[0]);
                    }
                });

                // Click to upload
                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });
            }

            // Wait for Firebase to be fully initialized
            async waitForFirebase() {
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK not loaded');
                }
                
                // Initialize Firebase if not already done
                if (!firebase.apps || firebase.apps.length === 0) {
                    console.log('üî• Initializing Firebase app...');
                    
                    // Wait for config to be loaded
                    let configAttempts = 0;
                    while (!window.config?.firebase && configAttempts < 20) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        configAttempts++;
                    }
                    
                    if (!window.config?.firebase) {
                        throw new Error('Firebase configuration not found');
                    }
                    
                    // Initialize Firebase
                    firebase.initializeApp(window.config.firebase);
                    console.log('‚úÖ Firebase app initialized');
                }
                
                // Wait for Firebase to be properly initialized
                let attempts = 0;
                const maxAttempts = 30; // 15 seconds max wait
                
                while (attempts < maxAttempts) {
                    if (firebase.apps && firebase.apps.length > 0) {
                        try {
                            // Test Firestore connection
                            const db = firebase.firestore();
                            await db.enableNetwork();
                            console.log('‚úÖ Firebase ready for production operations');
                            return;
                        } catch (error) {
                            console.log('Firebase connection test failed, retrying...', error.message);
                        }
                    }
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    attempts++;
                }
                
                throw new Error('Firebase initialization failed - production mode requires Firebase connection');
            }

            handleFileSelect(event) {
                const file = event.target.files[0];
                if (file && (file.type === 'text/csv' || file.type === 'text/plain' || file.name.endsWith('.txt') || file.name.endsWith('.csv'))) {
                    this.processCSVFile(file);
                } else {
                    this.showError('Please select a valid CSV or TXT file');
                }
            }

            async processCSVFile(file) {
                this.showLoading(true);
                this.hideMessages();

                try {
                    const text = await this.readFileAsText(file);
                    const games = this.parseCSV(text);
                    
                    if (games.length === 0) {
                        throw new Error('No valid games found in CSV');
                    }

                    // Production mode - requires Firebase
                    await this.saveGamesToFirestore(games);
                    
                    this.showSuccess(`Successfully uploaded ${games.length} games to production database!`);
                    
                    // Reload from Firebase to get updated data
                    await this.loadExistingGames();

                } catch (error) {
                    console.error('Error processing CSV:', error);
                    this.showError('Production Error: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            async processManualGames() {
                const manualTextarea = document.getElementById('manual-games-input');
                const gamesText = manualTextarea.value.trim();
                
                if (!gamesText) {
                    this.showError('Please enter games data in the text area');
                    return;
                }

                this.showLoading(true);
                this.hideMessages();

                try {
                    const games = this.parseCSV(gamesText);
                    
                    if (games.length === 0) {
                        throw new Error('No valid games found in the input');
                    }

                    // Production mode - requires Firebase
                    await this.saveGamesToFirestore(games);
                    
                    this.showSuccess(`Successfully processed ${games.length} games to production database!`);
                    manualTextarea.value = ''; // Clear the textarea
                    
                    // Reload from Firebase to get updated data
                    await this.loadExistingGames();
                    
                } catch (error) {
                    console.error('Error processing manual games:', error);
                    this.showError('Production Error: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(e);
                    reader.readAsText(file);
                });
            }

            parseCSV(text) {
                const lines = text.trim().split('\n');
                const games = [];
                const today = new Date().toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    const parts = line.split(',').map(part => part.trim().replace(/"/g, ''));
                    
                    // Check if it's the simple format (just Team A, Team B)
                    if (parts.length === 2) {
                        const [team1, team2] = parts;
                        
                        games.push({
                            id: `game_${Date.now()}_${i}`,
                            date: today, // Use today's date
                            team1: team1,
                            team2: team2,
                            time: '7:00 PM', // Default time
                            uploaded: new Date().toISOString()
                        });
                    }
                    // Original CSV format (Date, Team1, Team2, Time)
                    else if (parts.length >= 4) {
                        const [date, team1, team2, time] = parts;
                        
                        games.push({
                            id: `game_${Date.now()}_${i}`,
                            date: date,
                            team1: team1,
                            team2: team2,
                            time: time,
                            uploaded: new Date().toISOString()
                        });
                    }
                }

                return games;
            }

            async saveGamesToFirestore(games) {
                // Production mode - Firebase is required
                await this.waitForFirebase();
                
                const batch = firebase.firestore().batch();
                const gamesRef = firebase.firestore().collection('dailyGames');

                games.forEach(game => {
                    const docRef = gamesRef.doc(game.id);
                    batch.set(docRef, {
                        ...game,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });

                await batch.commit();
                console.log('‚úÖ Games saved to Firestore (Production)');
            }

            async loadExistingGames() {
                try {
                    // Production mode - Firebase is required
                    await this.waitForFirebase();
                    
                    const snapshot = await firebase.firestore()
                        .collection('dailyGames')
                        .orderBy('date', 'desc')
                        .limit(50)
                        .get();

                    this.games = [];
                    snapshot.forEach(doc => {
                        this.games.push({ id: doc.id, ...doc.data() });
                    });

                    if (this.games.length > 0) {
                        this.displayGames();
                    }
                    
                    console.log(`‚úÖ Loaded ${this.games.length} games from production database`);
                } catch (error) {
                    console.error('Production Error loading games:', error);
                    this.showError('Failed to load games from production database: ' + error.message);
                }
            }

            displayGames() {
                const container = document.getElementById('games-container');
                const section = document.getElementById('games-section');
                
                if (this.games.length === 0) {
                    section.style.display = 'none';
                    return;
                }

                section.style.display = 'block';
                container.innerHTML = '';

                this.games.forEach(game => {
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card';
                    gameCard.innerHTML = `
                        <div class="game-teams">${game.team1} vs ${game.team2}</div>
                        <div class="game-time">üìÖ ${game.date} at ${game.time}</div>
                        <button class="btn" onclick="admin.addGameToTodaysContest('${game.id}')" style="width: 100%;">
                            ‚ûï Add to Today's Contest
                        </button>
                    `;
                    container.appendChild(gameCard);
                });
            }

            async loadContests() {
                this.showContestsLoading(true);

                try {
                    // Load daily contests using the main API structure
                    const today = new Date().toISOString().split('T')[0];
                    const contests = [];
                    
                    // Check for contests in the past 7 days and next 7 days
                    for (let i = -7; i <= 7; i++) {
                        const checkDate = new Date();
                        checkDate.setDate(checkDate.getDate() + i);
                        const dateStr = checkDate.toISOString().split('T')[0];
                        
                        try {
                            // Use the same API the main page uses
                            const response = await fetch(`https://us-central1-nuts-sports-pickem.cloudfunctions.net/getDailyContest?date=${dateStr}`);
                            if (response.ok) {
                                const result = await response.json();
                                if (result.contest) {
                                    contests.push(result.contest);
                                }
                            }
                        } catch (error) {
                            console.log(`No contest found for ${dateStr}`);
                        }
                    }

                    this.contests = contests;
                    this.displayContests();
                    console.log(`‚úÖ Loaded ${this.contests.length} daily contests from API`);
                } catch (error) {
                    console.error('Error loading daily contests:', error);
                    this.showError('Failed to load daily contests: ' + error.message);
                } finally {
                    this.showContestsLoading(false);
                }
            }

            displayContests() {
                const table = document.getElementById('contests-table');
                const tbody = document.getElementById('contests-tbody');

                if (this.contests.length === 0) {
                    table.style.display = 'none';
                    return;
                }

                table.style.display = 'table';
                tbody.innerHTML = '';

                this.contests.forEach(contest => {
                    const row = this.createContestRow(contest);
                    tbody.appendChild(row);
                });
            }

            createContestRow(contest) {
                const row = document.createElement('tr');
                const contestDate = contest.contestDate || contest.id;
                const gameCount = contest.choices ? contest.choices.length : 0;

                row.innerHTML = `
                    <td>
                        <div style="font-weight: bold;">Daily Contest - ${contestDate}</div>
                        <div style="font-size: 12px; color: #888;">ID: ${contest.id}</div>
                    </td>
                    <td>${contestDate}</td>
                    <td>${this.getStatusBadge(contest)}</td>
                    <td>
                        <span style="font-weight: bold; color: #4CAF50;">${gameCount}</span> games
                    </td>
                    <td style="color: #ffd700;">50 $NUTS</td>
                    <td>${this.createActionButtons(contest)}</td>
                `;

                return row;
            }

            getStatusBadge(contest) {
                if (contest.status === 'resolved') {
                    return '<span class="status-badge status-resolved">‚úÖ Resolved</span>';
                }
                if (contest.status === 'locked' || contest.lockedAt) {
                    return '<span class="status-badge status-locked">üîí Locked</span>';
                }
                if (contest.active === true) {
                    return '<span class="status-badge status-published">üü¢ Active</span>';
                }
                return '<span class="status-badge status-draft">üìù Draft</span>';
            }

            createActionButtons(contest) {
                const buttons = [];
                const today = new Date().toISOString().split('T')[0];
                const isToday = contest.contestDate === today || contest.id === today;

                // Edit button - for active contests
                if (contest.status === 'active' && isToday) {
                    buttons.push(`
                        <button class="action-btn btn-edit" onclick="admin.editDailyContest('${contest.id}')">
                            ÔøΩ Edit Games
                        </button>
                    `);
                }

                // Lock button - for active contests
                if (contest.status === 'active' && !contest.lockedAt) {
                    buttons.push(`
                        <button class="action-btn" onclick="admin.lockDailyContest('${contest.id}')" style="background: #ff9800;">
                            üîí Lock Contest
                        </button>
                    `);
                }

                // Set Answers button - for locked contests
                if ((contest.status === 'locked' || contest.lockedAt) && contest.status !== 'resolved') {
                    buttons.push(`
                        <button class="action-btn btn-answers" onclick="admin.setDailyContestAnswers('${contest.id}')">
                            ‚úèÔ∏è Set Answers
                        </button>
                    `);
                }

                // Calculate Winners button - for contests with answers
                if (contest.status === 'locked' && contest.choices && contest.choices.every(c => c.correctAnswer)) {
                    buttons.push(`
                        <button class="action-btn btn-calculate" onclick="admin.resolveDailyContest('${contest.id}')">
                            üèÜ Resolve Contest
                        </button>
                    `);
                }

                // View Results button - for resolved contests
                if (contest.status === 'resolved') {
                    buttons.push(`
                        <button class="action-btn btn-winners" onclick="admin.viewDailyContestResults('${contest.id}')">
                            ÔøΩ View Results
                        </button>
                    `);
                }

                return `<div class="action-buttons">${buttons.join('')}</div>`;
            }

            addGameToTodaysContest(gameId) {
                const game = this.games.find(g => g.id === gameId);
                if (!game) {
                    alert('Game not found!');
                    return;
                }

                // Add to today's contest or create if it doesn't exist
                this.addGameToTodaysContestInternal(game);
            }

            async addGameToTodaysContestInternal(game) {
                const today = new Date().toISOString().split('T')[0];
                
                try {
                    // Check if today's contest already exists
                    const response = await fetch(`https://us-central1-nuts-sports-pickem.cloudfunctions.net/getDailyContest?date=${today}`);
                    let existingContest = null;
                    
                    if (response.ok) {
                        const result = await response.json();
                        existingContest = result.contest;
                    }

                    let choices = [];
                    if (existingContest && existingContest.choices) {
                        choices = [...existingContest.choices];
                    }

                    // Add the new game as a choice
                    choices.push({
                        id: `choice_${Date.now()}`,
                        question: `${game.team1} vs ${game.team2}`,
                        type: 'winner',
                        optionA: game.team1,
                        optionB: game.team2,
                        correctAnswer: null,
                        gameTime: game.time,
                        sport: 'daily'
                    });

                    // Create or update the contest
                    const contestData = {
                        id: today,
                        contestDate: today,
                        sport: 'daily',
                        entryFee: 50, // Fixed at 50 $NUTS
                        participantLimit: 1000,
                        prizePool: 0,
                        choices: choices,
                        active: true,
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };

                    // Save using the daily contest API
                    const saveResponse = await fetch('https://us-central1-nuts-sports-pickem.cloudfunctions.net/createDailyContest', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(contestData)
                    });

                    if (!saveResponse.ok) {
                        const error = await saveResponse.json();
                        throw new Error(error.error || 'Failed to save contest');
                    }

                    alert(`‚úÖ Game "${game.team1} vs ${game.team2}" added to today's daily contest!`);
                    this.loadContests(); // Refresh the list

                } catch (error) {
                    console.error('Error adding game to contest:', error);
                    alert('Error adding game to contest: ' + error.message);
                }
            }

            async createTodaysDailyContest() {
                const today = new Date().toISOString().split('T')[0];
                
                if (!confirm(`Create a new daily contest for ${today}? This will create an empty contest that you can add games to.`)) {
                    return;
                }

                try {
                    const contestData = {
                        id: today,
                        contestDate: today,
                        sport: 'daily',
                        entryFee: 50, // Fixed at 50 $NUTS
                        participantLimit: 1000,
                        prizePool: 0,
                        choices: [],
                        active: true,
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };

                    const response = await fetch('https://us-central1-nuts-sports-pickem.cloudfunctions.net/createDailyContest', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(contestData)
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Failed to create contest');
                    }

                    alert(`‚úÖ Daily contest created for ${today}! Now add games using the "Add to Today's Contest" buttons.`);
                    this.loadContests();

                } catch (error) {
                    console.error('Error creating daily contest:', error);
                    alert('Error creating daily contest: ' + error.message);
                }
            }

            async editDailyContest(contestId) {
                alert(`Edit daily contest ${contestId} - show games management interface`);
            }

            async lockDailyContest(contestId) {
                if (!confirm('Lock this daily contest? Players will no longer be able to enter.')) return;
                
                try {
                    // For now, just show a message - implement locking logic as needed
                    alert(`üîí Contest ${contestId} locked - implement locking via API`);
                } catch (error) {
                    console.error('Error locking contest:', error);
                    alert('Error locking contest: ' + error.message);
                }
            }

            async setDailyContestAnswers(contestId) {
                alert(`Set answers for daily contest ${contestId} - implement answer setting interface`);
            }

            async resolveDailyContest(contestId) {
                if (!confirm('Resolve this daily contest and calculate winners?')) return;
                
                try {
                    // Use the daily contest API to resolve
                    alert(`üèÜ Resolving contest ${contestId} - implement resolution via API`);
                } catch (error) {
                    console.error('Error resolving contest:', error);
                    alert('Error resolving contest: ' + error.message);
                }
            }

            async viewDailyContestResults(contestId) {
                alert(`View results for daily contest ${contestId} - implement results viewer`);
            }

            showContestModal(game) {
                const modal = document.getElementById('contest-modal');
                const title = document.getElementById('modal-title');
                const body = document.getElementById('modal-body');

                title.textContent = `Create Contest: ${game.team1} vs ${game.team2}`;
                
                body.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contest Title:</label>
                        <input type="text" id="contest-title" value="${game.team1} vs ${game.team2} - ${game.date}" 
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Entry Fee ($NUTS):</label>
                        <input type="number" id="entry-fee" value="10" min="1"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Participant Limit:</label>
                        <input type="number" id="participant-limit" value="100" min="4"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #4CAF50;">Contest Choices:</h4>
                        <div style="background: #2a2a2a; padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <div style="font-weight: bold; margin-bottom: 8px;">Who will win?</div>
                            <div>A: ${game.team1}</div>
                            <div>B: ${game.team2}</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn" onclick="admin.createContestFromGame('${game.id}')" style="margin-right: 10px;">
                            ‚úÖ Create Contest
                        </button>
                        <button class="btn btn-secondary" onclick="admin.closeModal()">
                            ‚ùå Cancel
                        </button>
                    </div>
                `;

                modal.style.display = 'flex';
            }

            async createContestFromGame(gameId) {
                const game = this.games.find(g => g.id === gameId);
                const title = document.getElementById('contest-title').value;
                const entryFee = parseInt(document.getElementById('entry-fee').value);
                const participantLimit = parseInt(document.getElementById('participant-limit').value);

                if (!title || entryFee < 1 || participantLimit < 4) {
                    alert('Please fill in all fields correctly!');
                    return;
                }

                try {
                    // Production mode - Firebase is required
                    await this.waitForFirebase();
                    
                    const contestData = {
                        title: title,
                        contestDate: firebase.firestore.Timestamp.fromDate(new Date(game.date)),
                        entryFee: entryFee,
                        participantLimit: participantLimit,
                        prizePool: 0,
                        choices: [{
                            question: "Who will win?",
                            optionA: game.team1,
                            optionB: game.team2,
                            correctAnswer: null
                        }],
                        gameId: gameId,
                        published: false,
                        locked: false,
                        resolved: false,
                        status: 'draft',
                        participantCount: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const docRef = await firebase.firestore().collection('dailyContests').add(contestData);
                    
                    this.closeModal();
                    alert('‚úÖ Contest created successfully in production database!');
                    this.loadContests(); // Refresh the list

                } catch (error) {
                    console.error('Production Error creating contest:', error);
                    alert('Production Error creating contest: ' + error.message);
                }
            }

            async editContest(contestId) {
                const contest = this.contests.find(c => c.id === contestId);
                if (!contest) {
                    alert('Contest not found!');
                    return;
                }
                
                const modal = document.getElementById('contest-modal');
                const title = document.getElementById('modal-title');
                const body = document.getElementById('modal-body');

                title.textContent = `Edit Contest: ${contest.title}`;
                
                body.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contest Title:</label>
                        <input type="text" id="edit-contest-title" value="${contest.title}" 
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Entry Fee ($NUTS):</label>
                        <input type="number" id="edit-entry-fee" value="${contest.entryFee}" min="1"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Participant Limit:</label>
                        <input type="number" id="edit-participant-limit" value="${contest.participantLimit}" min="4"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Status:</label>
                        <select id="edit-status" style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                            <option value="draft" ${contest.status === 'draft' ? 'selected' : ''}>üìù Draft</option>
                            <option value="published" ${contest.published ? 'selected' : ''}>üü¢ Published</option>
                            <option value="locked" ${contest.locked ? 'selected' : ''}>üîí Locked</option>
                        </select>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn" onclick="admin.updateContest('${contestId}')" style="margin-right: 10px;">
                            ‚úÖ Update Contest
                        </button>
                        <button class="btn btn-warning" onclick="admin.publishContest('${contestId}')" style="margin-right: 10px;">
                            üöÄ Publish to Website
                        </button>
                        <button class="btn btn-secondary" onclick="admin.closeModal()">
                            ‚ùå Cancel
                        </button>
                    </div>
                `;

                modal.style.display = 'flex';
            }

            async updateContest(contestId) {
                const title = document.getElementById('edit-contest-title').value;
                const entryFee = parseInt(document.getElementById('edit-entry-fee').value);
                const participantLimit = parseInt(document.getElementById('edit-participant-limit').value);
                const status = document.getElementById('edit-status').value;

                if (!title || entryFee < 1 || participantLimit < 4) {
                    alert('Please fill in all fields correctly!');
                    return;
                }

                try {
                    await this.waitForFirebase();
                    
                    const updateData = {
                        title: title,
                        entryFee: entryFee,
                        participantLimit: participantLimit,
                        status: status,
                        published: status === 'published',
                        locked: status === 'locked',
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await firebase.firestore().collection('dailyContests').doc(contestId).update(updateData);
                    
                    this.closeModal();
                    alert('‚úÖ Contest updated successfully!');
                    this.loadContests();

                } catch (error) {
                    console.error('Error updating contest:', error);
                    alert('Error updating contest: ' + error.message);
                }
            }

            async publishContest(contestId) {
                try {
                    await this.waitForFirebase();
                    
                    const updateData = {
                        published: true,
                        status: 'published',
                        publishedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await firebase.firestore().collection('dailyContests').doc(contestId).update(updateData);
                    
                    this.closeModal();
                    alert('üöÄ Contest published to main website!');
                    this.loadContests();

                } catch (error) {
                    console.error('Error publishing contest:', error);
                    alert('Error publishing contest: ' + error.message);
                }
            }

            async setAnswers(contestId) {
                const contest = this.contests.find(c => c.id === contestId);
                if (!contest) {
                    alert('Contest not found!');
                    return;
                }
                
                const modal = document.getElementById('contest-modal');
                const title = document.getElementById('modal-title');
                const body = document.getElementById('modal-body');

                title.textContent = `Set Answers: ${contest.title}`;
                
                let choicesHtml = '';
                contest.choices.forEach((choice, index) => {
                    choicesHtml += `
                        <div style="margin-bottom: 20px; background: #2a2a2a; padding: 15px; border-radius: 6px;">
                            <div style="font-weight: bold; margin-bottom: 10px;">${choice.question}</div>
                            <div style="margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                    <input type="radio" name="answer_${index}" value="A" ${choice.correctAnswer === 'A' ? 'checked' : ''} style="margin-right: 8px;">
                                    A: ${choice.optionA}
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="radio" name="answer_${index}" value="B" ${choice.correctAnswer === 'B' ? 'checked' : ''} style="margin-right: 8px;">
                                    B: ${choice.optionB}
                                </label>
                            </div>
                        </div>
                    `;
                });
                
                body.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <p style="color: #ccc;">Select the correct answers for this contest:</p>
                        ${choicesHtml}
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn" onclick="admin.saveAnswers('${contestId}')" style="margin-right: 10px;">
                            ‚úÖ Save Answers
                        </button>
                        <button class="btn btn-secondary" onclick="admin.closeModal()">
                            ‚ùå Cancel
                        </button>
                    </div>
                `;

                modal.style.display = 'flex';
            }

            async saveAnswers(contestId) {
                const contest = this.contests.find(c => c.id === contestId);
                if (!contest) return;

                try {
                    const updatedChoices = contest.choices.map((choice, index) => {
                        const selectedAnswer = document.querySelector(`input[name="answer_${index}"]:checked`);
                        return {
                            ...choice,
                            correctAnswer: selectedAnswer ? selectedAnswer.value : null
                        };
                    });

                    await this.waitForFirebase();
                    
                    const updateData = {
                        choices: updatedChoices,
                        answersSet: true,
                        answersSetAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await firebase.firestore().collection('dailyContests').doc(contestId).update(updateData);
                    
                    this.closeModal();
                    alert('‚úÖ Answers saved successfully!');
                    this.loadContests();

                } catch (error) {
                    console.error('Error saving answers:', error);
                    alert('Error saving answers: ' + error.message);
                }
            }

            async lockContest(contestId) {
                if (!confirm('Lock this contest? Players will no longer be able to enter.')) return;

                try {
                    await this.waitForFirebase();
                    
                    const updateData = {
                        locked: true,
                        status: 'locked',
                        lockedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await firebase.firestore().collection('dailyContests').doc(contestId).update(updateData);
                    
                    alert('üîí Contest locked successfully!');
                    this.loadContests();

                } catch (error) {
                    console.error('Error locking contest:', error);
                    alert('Error locking contest: ' + error.message);
                }
            }

            async deleteContest(contestId) {
                if (!confirm('‚ö†Ô∏è Are you sure you want to delete this contest? This action cannot be undone!')) return;

                try {
                    await this.waitForFirebase();
                    
                    await firebase.firestore().collection('dailyContests').doc(contestId).delete();
                    
                    alert('üóëÔ∏è Contest deleted successfully!');
                    this.loadContests();

                } catch (error) {
                    console.error('Error deleting contest:', error);
                    alert('Error deleting contest: ' + error.message);
                }
            }

            showCreateNewContestModal() {
                const modal = document.getElementById('contest-modal');
                const title = document.getElementById('modal-title');
                const body = document.getElementById('modal-body');

                title.textContent = 'Create New Contest';
                
                body.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contest Title:</label>
                        <input type="text" id="new-contest-title" placeholder="e.g., Yankees vs Red Sox - Today" 
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Contest Date:</label>
                        <input type="date" id="new-contest-date" value="${new Date().toISOString().split('T')[0]}"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Entry Fee ($NUTS):</label>
                        <input type="number" id="new-entry-fee" value="10" min="1"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Participant Limit:</label>
                        <input type="number" id="new-participant-limit" value="100" min="4"
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Question:</label>
                        <input type="text" id="new-question" value="Who will win?" 
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Option A:</label>
                        <input type="text" id="new-option-a" placeholder="e.g., Yankees" 
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Option B:</label>
                        <input type="text" id="new-option-b" placeholder="e.g., Red Sox" 
                               style="width: 100%; padding: 10px; background: #333; border: 1px solid #555; color: white; border-radius: 4px;">
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn" onclick="admin.createNewContestFromForm()" style="margin-right: 10px;">
                            ‚úÖ Create Contest
                        </button>
                        <button class="btn btn-secondary" onclick="admin.closeModal()">
                            ‚ùå Cancel
                        </button>
                    </div>
                `;

                modal.style.display = 'flex';
            }

            async createNewContestFromForm() {
                const title = document.getElementById('new-contest-title').value.trim();
                const contestDate = document.getElementById('new-contest-date').value;
                const entryFee = parseInt(document.getElementById('new-entry-fee').value);
                const participantLimit = parseInt(document.getElementById('new-participant-limit').value);
                const question = document.getElementById('new-question').value.trim();
                const optionA = document.getElementById('new-option-a').value.trim();
                const optionB = document.getElementById('new-option-b').value.trim();

                if (!title || !contestDate || entryFee < 1 || participantLimit < 4 || !question || !optionA || !optionB) {
                    alert('Please fill in all fields correctly!');
                    return;
                }

                try {
                    await this.waitForFirebase();
                    
                    const contestData = {
                        title: title,
                        contestDate: firebase.firestore.Timestamp.fromDate(new Date(contestDate)),
                        entryFee: entryFee,
                        participantLimit: participantLimit,
                        prizePool: 0,
                        choices: [{
                            question: question,
                            optionA: optionA,
                            optionB: optionB,
                            correctAnswer: null
                        }],
                        published: false,
                        locked: false,
                        resolved: false,
                        status: 'draft',
                        participantCount: 0,
                        answersSet: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const docRef = await firebase.firestore().collection('dailyContests').add(contestData);
                    
                    this.closeModal();
                    alert('‚úÖ Contest created successfully! You can now edit and publish it.');
                    this.loadContests();

                } catch (error) {
                    console.error('Error creating contest:', error);
                    alert('Error creating contest: ' + error.message);
                }
            }

            async calculateWinners(contestId) {
                if (!confirm('Calculate winners for this contest?')) return;

                try {
                    const calculateWinnersFunction = firebase.functions().httpsCallable('calculateDailyContestWinners');
                    const result = await calculateWinnersFunction({ contestId });

                    if (result.data.success) {
                        alert(`‚úÖ Winners calculated! ${result.data.winnerCount} winners from ${result.data.totalEntries} entries`);
                        this.loadContests();
                    } else {
                        throw new Error(result.data.error || 'Failed to calculate winners');
                    }
                } catch (error) {
                    console.error('Error calculating winners:', error);
                    alert('Error calculating winners: ' + error.message);
                }
            }

            async getWinners(contestId) {
                try {
                    // Get winner information
                    const db = firebase.firestore();
                    const contestDoc = await db.collection('dailyContests').doc(contestId).get();
                    const contest = contestDoc.data();
                    
                    const winnersSnapshot = await db.collection('dailyContestParticipants')
                        .where('contestId', '==', contestId)
                        .where('isWinner', '==', true)
                        .orderBy('winnerRank')
                        .get();

                    if (winnersSnapshot.empty) {
                        alert('No winners found. Make sure to calculate winners first.');
                        return;
                    }

                    let winnersInfo = `üèÜ WINNERS for "${contest.title}"\n\n`;
                    
                    winnersSnapshot.forEach(doc => {
                        const winner = doc.data();
                        const rankEmoji = winner.winnerRank === 1 ? 'ü•á' : winner.winnerRank === 2 ? 'ü•à' : 'ü•â';
                        winnersInfo += `${rankEmoji} Place ${winner.winnerRank}: ${winner.walletAddress}\n`;
                        winnersInfo += `   Prize: ${winner.prizeAmount} $NUTS\n\n`;
                    });

                    // Show in modal or copy to clipboard
                    navigator.clipboard.writeText(winnersInfo).then(() => {
                        alert('Winners information copied to clipboard!');
                    });

                } catch (error) {
                    console.error('Error getting winners:', error);
                    alert('Error getting winners: ' + error.message);
                }
            }

            closeModal() {
                document.getElementById('contest-modal').style.display = 'none';
            }

            // Upload method switching
            switchUploadMethod(method) {
                const csvTab = document.getElementById('csv-tab');
                const manualTab = document.getElementById('manual-tab');
                const csvArea = document.getElementById('csv-upload-area');
                const manualArea = document.getElementById('manual-upload-area');

                if (method === 'csv') {
                    csvTab.className = 'btn';
                    manualTab.className = 'btn btn-secondary';
                    csvArea.style.display = 'block';
                    manualArea.style.display = 'none';
                } else {
                    csvTab.className = 'btn btn-secondary';
                    manualTab.className = 'btn';
                    csvArea.style.display = 'none';
                    manualArea.style.display = 'block';
                }
            }

            // Clear manual input
            clearManualInput() {
                document.getElementById('manual-games-input').value = '';
            }

            showLoading(show) {
                document.getElementById('upload-status').style.display = show ? 'block' : 'none';
            }

            showContestsLoading(show) {
                document.getElementById('contests-loading').style.display = show ? 'block' : 'none';
            }

            showSuccess(message) {
                const el = document.getElementById('upload-success');
                el.textContent = '‚úÖ ' + message;
                el.style.display = 'block';
                setTimeout(() => el.style.display = 'none', 5000);
            }

            showError(message) {
                const el = document.getElementById('upload-error');
                el.textContent = '‚ùå ' + message;
                el.style.display = 'block';
                setTimeout(() => el.style.display = 'none', 5000);
            }

            hideMessages() {
                document.getElementById('upload-success').style.display = 'none';
                document.getElementById('upload-error').style.display = 'none';
            }
        }

        // Global functions
        function refreshContests() {
            admin.loadContests();
        }

        function createTodaysDailyContest() {
            admin.createTodaysDailyContest();
        }

        // Initialize admin system
        let admin;
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìã DOM Content Loaded');
            console.log('üîß Config available:', !!window.config);
            console.log('üî• Firebase SDK:', typeof firebase);
            console.log('üì¶ Firebase apps:', firebase?.apps?.length || 0);
            
            admin = new UnifiedAdmin();
        });

        // Close modal when clicking outside
        document.getElementById('contest-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                admin.closeModal();
            }
        });
    </script>
</body>
</html>
